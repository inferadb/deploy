# Kernel sysctl configuration patch
# Applied to all nodes via talhelper

machine:
  sysctls:
    # Network performance tuning
    net.core.somaxconn: "65535"
    net.core.netdev_max_backlog: "65535"
    net.ipv4.tcp_max_syn_backlog: "65535"

    # Connection tracking for high connection counts
    net.netfilter.nf_conntrack_max: "1048576"

    # File descriptor limits
    fs.file-max: "2097152"
    fs.inotify.max_user_watches: "1048576"
    fs.inotify.max_user_instances: "8192"

    # Memory management
    vm.max_map_count: "262144"
    vm.swappiness: "1"

    # Enable IP forwarding (required for CNI)
    net.ipv4.ip_forward: "1"
    net.ipv6.conf.all.forwarding: "1"
