# Infracost Configuration for InferaDB Deployment Infrastructure
# Multi-environment, multi-region, multi-provider cost estimation
#
# Usage:
#   infracost breakdown --config-file infracost.yml --format table
#   infracost diff --config-file infracost.yml --compare-to infracost-base.json
#
# For CI/CD:
#   infracost breakdown --config-file infracost.yml --format json --out-file infracost.json
#
# Usage estimates for variable-cost resources are defined in infracost-usage.yml
# Run with: infracost breakdown --config-file=infracost.yml --usage-file=infracost-usage.yml

version: 0.1

projects:
  # ============================================================================
  # Development Environment
  # ============================================================================
  # Dev with AWS (default provider)
  - path: terraform/environments/dev
    name: dev-aws
    terraform_vars:
      provider_type: aws
      region: nyc1
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # Dev with GCP
  - path: terraform/environments/dev
    name: dev-gcp
    terraform_vars:
      provider_type: gcp
      region: sfo1
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # Dev with DigitalOcean
  - path: terraform/environments/dev
    name: dev-digitalocean
    terraform_vars:
      provider_type: digitalocean
      region: nyc1
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # ============================================================================
  # Staging Environment
  # ============================================================================
  # Staging with AWS (single region)
  - path: terraform/environments/staging
    name: staging-aws-single
    terraform_vars:
      provider_type: aws
      region: nyc1
      enable_multi_region: false
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # Staging with AWS (multi-region)
  - path: terraform/environments/staging
    name: staging-aws-multi
    terraform_vars:
      provider_type: aws
      region: nyc1
      enable_multi_region: true
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # Staging with GCP (single region)
  - path: terraform/environments/staging
    name: staging-gcp-single
    terraform_vars:
      provider_type: gcp
      region: sfo1
      enable_multi_region: false
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # ============================================================================
  # Production Environment
  # ============================================================================
  # Production with AWS (always multi-region)
  - path: terraform/environments/production
    name: production-aws
    terraform_vars:
      provider_type: aws
      # Placeholder values for cost estimation (actual values come from deployment)
      vpc_id_nyc1: vpc-placeholder
      vpc_id_sfo1: vpc-placeholder
      subnet_ids_nyc1: '["subnet-a", "subnet-b", "subnet-c"]'
      subnet_ids_sfo1: '["subnet-a", "subnet-b", "subnet-c"]'
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # Production with GCP (always multi-region)
  - path: terraform/environments/production
    name: production-gcp
    terraform_vars:
      provider_type: gcp
      # Placeholder values for cost estimation (actual values come from deployment)
      vpc_id_nyc1: vpc-placeholder
      vpc_id_sfo1: vpc-placeholder
      subnet_ids_nyc1: '["subnet-a", "subnet-b", "subnet-c"]'
      subnet_ids_sfo1: '["subnet-a", "subnet-b", "subnet-c"]'
    dependency_paths:
      - "terraform/modules/**"
      - "terraform/regions/**"

  # ============================================================================
  # Individual Modules (for granular cost analysis)
  # ============================================================================
  # Talos Cluster module - AWS variant
  - path: terraform/modules/talos-cluster
    name: module-talos-cluster-aws
    terraform_vars:
      provider_type: aws
      cluster_name: cost-estimation
      cluster_endpoint_hostname: api.cost-estimation.inferadb.io
      region: nyc1
      provider_region: us-east-1
      environment: dev
      control_plane_count: 3
      worker_count: 3
      worker_machine_type: medium
      use_spot_instances: false
    skip_autodetect: true

  # Note: The following modules are placeholders without cost-bearing resources:
  # - terraform/modules/cost-alerts
  # - terraform/modules/dns
  # - terraform/modules/fdb-backup
  # - terraform/modules/tailscale-subnet-router
